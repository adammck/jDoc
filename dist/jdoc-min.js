(function(){var e=this.jDoc=function(a){if(arguments.length===2){var b=arguments[1];this._list=arguments[0];this._index=b}else{this._list=a!==null?[a]:[];this._index=0}},j=new e(null),k=function(a,b){if(typeof b==="object"&&typeof b.length==="number")for(var d=0;d<b.length;++d)a.push(b[d]);else a.push(b)},i=function(a,b,d,c){a.each(function(g){g=g.json();for(var h in g){var f=g[h];if(typeof f!=="function"){b(h)&&k(c,f);if(d)if(typeof f==="object")typeof f.length==="number"?i(new e(f,0),b,d,c):i(new e(f),
b,d,c)}}})},l=function(a){return typeof a==="function"?a:a instanceof RegExp?function(b){return a.test(b)}:function(b){return b===a}},m={};$.extend(e.prototype,{any:function(){return this._list.length>0},first:function(){return new e(this._list,0)},next:function(){if(!this.hasValue())return this;var a=this._index+1;if(a<this._list.length)return new e(this._list,a);return j},each:function(a,b){for(var d=0,c=this._list[0];typeof c!=="undefined"&&a.call(b,new e(c))!==false;c=this._list[++d]);},count:function(){return this._list.length},
get:function(a){if(a>=0&&a<this._list.length)return new e([this._list[a]],0);return j},where:function(a,b){var d=[];this.each(function(c){a.call(b,c)&&k(d,c.json())});return new e(d,0)},union:function(a){if(!this.any())return a;if(!a.any())return this;return new e(this._list.concat(a._list),0)},select:function(a,b){var d=[];this.each(function(c){d.push(a.call(b,c))});return d},hasValue:function(){return this._index<this._list.length},json:function(){if(!this.hasValue())throw new Exception("jDoc has no value");
return this._list[this._index]},text:function(){for(var a=this.json();a!==null;)switch(typeof a){case "boolean":case "number":return a.toString();case "string":return a;case "object":if(typeof a.length==="undefined"){a=a["#text"];return typeof a!=="undefined"?a:null}else if(a.length>0)a=a[0];else return null;break;default:return null}return null},match:function(a){if(!this.hasValue())return this;var b=[];i(this,l(a),false,b);return new e(b,0)},deepMatch:function(a){if(!this.hasValue())return this;
var b=[];i(this,l(a),true,b);return new e(b,0)},attributes:function(){return this.match(/^@.+$/)},elements:function(){return this.match(/^[^@#].*$/)},$:function(a){var b;if(typeof(b=m[a])==="undefined"){b=Function;if(typeof a!=="string"||a==="")throw new Exception("invalid selector");for(var d=a.split("/"),c=false,g="this",h=0;h<d.length;++h){var f=d[h];switch(f){case "":if(h===0)continue;if(c)throw new Exception("invalid selector");c=true;continue;case ".":break;case "..":throw new Exception("unsupported .. operation in selector");
case "*":g+=c?".deepMatch(/^[^@#].*$/)":".match(/^[^@#].*$/)";break;case "@*":g+=c?".deepMatch(/^@.+$/)":".match(/^@.+$/)";break;default:g+=c?'.deepMatch("'+f.replace('"','\\"')+'")':'.match("'+f.replace('"','\\"')+'")'}c=false}if(c)throw new Exception("invalid selector");m[a]=b=new b("return "+g)}return b.call(this)}})})();
